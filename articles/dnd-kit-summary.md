---
title: "dnd kit"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [react, nextjs, typescript]
published: false
---

## dnd kit ã¨ã¯ï¼Ÿ

React ç”¨ã®é«˜åº¦ãª Dï¼†D ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã€‚
dnd kit ã«ã¯è¤‡æ•°ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚

1. **`@dnd-kit/core`**
   - dnd kit ã®æ ¸ã¨ãªã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
   - D&D ã®åŸºæœ¬æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹
   - ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªè¦ç´ ã¨ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªã‚¨ãƒªã‚¢ã‚’å®šç¾©ã™ã‚‹ãŸã‚ã® API ã‚’æä¾›ã—ã€D&D ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹
2. **`@dnd-kit/sortable`**
   - ãƒªã‚¹ãƒˆã‚„ã‚°ãƒªãƒƒãƒ‰å†…ã®è¦ç´ ã‚’ä¸¦ã¹æ›¿ãˆã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹
3. **`@dnd-kit/modifiers`**
   - ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œä¸­ã«ç‰¹å®šã®åˆ¶ç´„ã‚„æŒ™å‹•ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ãƒ¢ãƒ‡ã‚£ãƒ•ã‚¡ã‚¤ã‚¢ã‚’æä¾›ã™ã‚‹
   - ä»¥ä¸‹ã®ã‚ˆã†ãªç”¨é€”ã«ä½¿ç”¨ã™ã‚‹
     - å˜ä¸€è»¸ã«æ²¿ã£ãŸå‹•ãã‚’åˆ¶é™ã™ã‚‹
     - ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒãƒ¼ãƒ‰ã‚³ãƒ³ãƒ†ãƒŠã®å¢ƒç•ŒçŸ©å½¢å†…ã§ã®å‹•ãã‚’åˆ¶é™ã™ã‚‹
     - ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªãƒãƒ¼ãƒ‰ã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚³ãƒ³ãƒ†ãƒŠã®å¢ƒç•ŒçŸ©å½¢å†…ã§ã®å‹•ãã‚’åˆ¶é™ã™ã‚‹
     - ç§»å‹•ã«æŠµæŠ—ã‚’åŠ ãˆãŸã‚Šã€ç§»å‹•ã‚’åˆ¶é™ï¼ˆã‚¯ãƒ©ãƒ³ãƒ—ï¼‰ã™ã‚‹
4. **`@dnd-kit/accessibility`**
   - ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã®æ“ä½œã‚’ã‚¢ã‚¯ã‚»ã‚·ãƒ–ãƒ«ï¼ˆéšœå®³ã‚’æŒã¤ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚‚ä½¿ã„ã‚„ã™ã„ï¼‰ã«ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®ã‚µãƒãƒ¼ãƒˆã‚„ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒªãƒ¼ãƒ€ãƒ¼ã®å¯¾å¿œãªã©ãŒå«ã¾ã‚Œã‚‹

## D&D ã‚’å®Ÿè£…ã—ã¦ã¿ã‚‹

D&D ã«ã‚ˆã‚Šãƒ¡ãƒ³ãƒãƒ¼ãŒå„ã‚°ãƒ«ãƒ¼ãƒ—é–“ã‚’ç§»å‹•ã§ãã‚‹ã‚ˆã†ãª UI ã‚’å®Ÿè£…ã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/83cab4ed1cfa-20231214.gif)

### ã‚°ãƒ«ãƒ¼ãƒ—ãƒ‡ãƒ¼ã‚¿ã®ç”¨æ„

è¤‡æ•°ã®ã‚°ãƒ«ãƒ¼ãƒ—ãŒå­˜åœ¨ã—ã€å„ã‚°ãƒ«ãƒ¼ãƒ—ã«ã¯è¤‡æ•°ã®ãƒ¡ãƒ³ãƒãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚

```tsx
type Group = {
  id: string;
  members: Member[];
};

type Member = {
  name: string;
};

export const DndKit = () => {
  const [groups, setGroups] = useState<Group[]>([
    { id: "group_1", members: [{ name: "member_1" }, { name: "member_2" }] },
    { id: "group_2", members: [{ name: "member_3" }] },
    { id: "group_3", members: [{ name: "member_4" }, { name: "member_5" }] },
  ]);

  // çœç•¥
};
```

### D&D ã®ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
yarn add @dnd-kit/core
```

### DnDContext

D&D æ©Ÿèƒ½ã‚’å®Ÿè£…ã™ã‚‹ãŸã‚ã«ã€ã¾ãš `DndContext` ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚
ã“ã‚Œã¯ã€Dï¼†D ã‚¤ãƒ™ãƒ³ãƒˆã®ç®¡ç†ã‚„çŠ¶æ…‹ã®ä¿æŒã‚’è¡Œã†ã€‚
ã“ã®ä¸­ã«ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãŠã‚ˆã³ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªè¦ç´ ã‚’é…ç½®ã™ã‚‹ã“ã¨ã§ã€Dï¼†D ã®ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚‹ã€‚

```tsx
import { DndContext } from "@dnd-kit/core";

function DndKit() {
  return <DndContext>{/* ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—è¦ç´ ã‚’ã“ã“ã«é…ç½® */}</DndContext>;
}
```

### ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªè¦ç´ ã®ä½œæˆ

`useDraggable` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
ã“ã®ãƒ•ãƒƒã‚¯ã®è¿”ã‚Šå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»»æ„ã®è¦ç´ ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«ã™ã‚‹ã€‚
å¼•æ•°ã«ã¯ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªã‚¨ãƒªã‚¢ã‚’ãƒ¦ãƒ‹ãƒ¼ã‚¯ã«è­˜åˆ¥ã™ã‚‹ãŸã‚ã® `id`ï¼ˆ`number` or `strign`ï¼‰ã‚’æ¸¡ã™ã€‚

ä¸»è¦ãªè¿”ã‚Šå€¤ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

1. **`setNodeRef`**
   - ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ã‚¤ãƒ†ãƒ ã® DOM ãƒãƒ¼ãƒ‰ã¸ã®å‚ç…§ã‚’è¨­å®šã™ã‚‹ãŸã‚ã®é–¢æ•°
   - ãƒ‰ãƒ©ãƒƒã‚°ã•ã›ãŸã„è¦ç´ ã® `ref` ã«æŒ‡å®šã™ã‚‹
2. **`listeners`**
   - ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã‚’é–‹å§‹ã€é€²è¡Œã€çµ‚äº†ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
3. **`attributes`**
   - ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ãªè¦ç´ ã«é©ç”¨ã•ã‚Œã‚‹ HTML å±æ€§ã‚’å«ã‚€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
4. **`transform`**
   - ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œä¸­ã®è¦ç´ ã®ä½ç½®å¤‰åŒ–ã‚’è¡¨ã™ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
   - ã‚¢ã‚¤ãƒ†ãƒ ãŒãƒ‰ãƒ©ãƒƒã‚°ã•ã‚Œå§‹ã‚ã‚‹ã¨ã€ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç”»é¢ä¸Šã§ç§»å‹•ã•ã›ã‚‹ãŸã‚ã«å¿…è¦ãªåº§æ¨™ãŒå…¥åŠ›ã•ã‚Œã‚‹
   - ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆå½¢å¼ã¯ `{x: number, y: number, scaleX: number, scaleY: number}`
   - `transform` ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã®è¦ç´ ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å‹•çš„ã«æ›´æ–°ã™ã‚‹
5. **`isDragging`**
   - ã‚¢ã‚¤ãƒ†ãƒ ãŒãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ã‚ã‚‹ã‹ã®ãƒ•ãƒ©ã‚°
   - ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã§ã‚ã‚Œã° `true`ã€ãã†ã§ãªã‘ã‚Œã° `false`

```tsx
type MemberItemProps = {
  member: Member;
};

const MemberItem = ({ member }: MemberItemProps) => {
  const { attributes, listeners, setNodeRef, transform, isDragging } =
    useDraggable({
      id: member.name,
    });

  const style: CSSProperties = {
    // `@dnd-kit/utilities`ã®`CSS`ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€ã‚ˆã‚Šç°¡æ½”ã«è¨˜è¿°ã§ãã‚‹
    // transform: CSS.Translate.toString(transform),
    transform: transform
      ? `translate3d(${transform.x}px, ${transform.y}px, 0)`
      : undefined,
    cursor: isDragging ? "grabbing" : "grab",
  };

  return (
    <div
      ref={setNodeRef}
      {...attributes}
      {...listeners}
      style={style}
      className={styles.member}
    >
      {member.name}
    </div>
  );
};
```

### ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªã‚¨ãƒªã‚¢ã®ä½œæˆ

`useDropable` ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
ã“ã®ãƒ•ãƒƒã‚¯ã®è¿”ã‚Šå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»»æ„ã®è¦ç´ ã‚’ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªã‚¨ãƒªã‚¢ã«ã™ã‚‹ã€‚
å¼•æ•°ã«ã¯ `useDraggable` ã¨åŒæ§˜ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ãª `id` ã‚’æŒ‡å®šã™ã‚‹ã€‚
è¿”ã‚Šå€¤ã§ `setNodeRef` ã‚’å—ã‘å–ã‚Šã€ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½è¦ç´ ã® `ref` ã«æŒ‡å®šã™ã‚‹ã€‚

```tsx
type GroupItemProps = {
  group: Group;
};

const GroupItem = ({ group }: GroupItemProps) => {
  const { setNodeRef } = useDroppable({
    id: group.id,
  });

  return (
    <div className={styles.groupItem}>
      <div className={styles.groupHead}>{group.id}</div>
      <div ref={setNodeRef} className={styles.groupBody}>
        {group.members.map((member) => (
          <MemberItem key={member.name} member={member} />
        ))}
      </div>
    </div>
  );
};
```

### ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã™ã‚‹

`onDragEnd` ã¯ãƒ¦ãƒ¼ã‚¶ãŒãƒ‰ãƒ©ãƒƒã‚°ã—ãŸè¦ç´ ã‚’é›¢ã—ãŸã¨ãã«å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚
ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã®æœ€çµ‚çš„ãªçµæœã‚’å‡¦ç†ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã€ãƒ‰ãƒ©ãƒƒã‚°ã•ã‚ŒãŸè¦ç´ ã®æ–°ã—ã„ä½ç½®ã‚„çŠ¶æ…‹ã®æ›´æ–°ãªã©ã‚’è¡Œã†ã€‚
`onDragEnd` ã«æ¸¡ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã«é–¢ã™ã‚‹ä»¥ä¸‹ã®æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã€‚

1. **`active`**
   - ãƒ‰ãƒ©ãƒƒã‚°ã•ã‚Œã¦ã„ãŸè¦ç´ ã«é–¢ã™ã‚‹æƒ…å ±
   - `active.id` ã¯ `useDraggable` ã§æŒ‡å®šã—ãŸ `id`
2. **`over`**
   - ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸè¦ç´ ã«é–¢ã™ã‚‹æƒ…å ±
   - `over.id` ã¯ `useDroppable` ã§æŒ‡å®šã—ãŸ `id`
   - ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½é ˜åŸŸã§ãªã„å ´åˆã€`over` ã¯ `null` ã«ãªã‚‹

```diff tsx
+  import { DragEndEvent } from "@dnd-kit/core";

   export const DndKit = () => {
     // çœç•¥

+    const handleDragEnd = (e: DragEndEvent) => {
+      const { active, over } = e;
+      if (!over) return;
+
+      const draggedId = active.id as string;
+      const droppedId = over.id as string;
+
+      setGroups((prev) => {
+        return prev.map((group) => {
+          const isDroppedSameGroup =
+            group.members.some((member) => member.name === draggedId) &&
+            droppedId === group.id;
+          if (isDroppedSameGroup) return group;
+
+          const newMembers = group.members.filter(
+            (member) => member.name !== draggedId
+          );
+
+          if (droppedId === group.id) newMembers.push({ name: draggedId });
+
+          return { ...group, members: newMembers };
+        });
+      });
+    };

    return (
      // çœç•¥
    );
  };
```

### D&D ã¾ã¨ã‚

1. D&D ã™ã‚‹é ˜åŸŸã‚’ `DnDContext` ã§å›²ã‚€
2. ãƒ‰ãƒ©ãƒƒã‚°ã—ãŸã„è¦ç´ ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã€`useDraggable` ã‚’ä½¿ç”¨ã™ã‚‹
3. ãƒ‰ãƒ­ãƒƒãƒ—ã—ãŸã„è¦ç´ ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã—ã€`useDroppable` ã‚’ä½¿ç”¨ã™ã‚‹

æœ€çµ‚çš„ãªã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

```tsx
import {
  DndContext,
  DragEndEvent,
  useDraggable,
  useDroppable,
} from "@dnd-kit/core";
import { CSSProperties, useState } from "react";
import styles from "@/styles/DndKit.module.scss";
import { CSS } from "@dnd-kit/utilities";

type Group = {
  id: string;
  members: Member[];
};

type Member = {
  name: string;
};

export const DndKit = () => {
  const [groups, setGroups] = useState<Group[]>([
    { id: "group_1", members: [{ name: "member_1" }, { name: "member_2" }] },
    { id: "group_2", members: [{ name: "member_3" }] },
    { id: "group_3", members: [{ name: "member_4" }, { name: "member_5" }] },
  ]);

  const handleDragEnd = (e: DragEndEvent) => {
    const { active, over } = e;
    if (!over) return;

    const draggedId = active.id as string;
    const droppedId = over.id as string;

    setGroups((prev) => {
      return prev.map((group) => {
        const isDroppedSameGroup =
          group.members.some((member) => member.name === draggedId) &&
          droppedId === group.id;
        if (isDroppedSameGroup) return group;

        const newMembers = group.members.filter(
          (member) => member.name !== draggedId
        );

        if (droppedId === group.id) newMembers.push({ name: draggedId });

        return { ...group, members: newMembers };
      });
    });
  };

  return (
    <DndContext onDragEnd={handleDragEnd}>
      <div className={styles.groupContainer}>
        {groups.map((group) => (
          <GroupItem key={group.id} group={group} />
        ))}
      </div>
    </DndContext>
  );
};

type GroupItemProps = {
  group: Group;
};

const GroupItem = ({ group }: GroupItemProps) => {
  const { setNodeRef } = useDroppable({
    id: group.id,
  });

  return (
    <div className={styles.groupItem}>
      <div className={styles.groupHead}>{group.id}</div>
      <div ref={setNodeRef} className={styles.groupBody}>
        {group.members.map((member) => (
          <MemberItem key={member.name} member={member} />
        ))}
      </div>
    </div>
  );
};

type MemberItemProps = {
  member: Member;
};

const MemberItem = ({ member }: MemberItemProps) => {
  const { attributes, listeners, setNodeRef, transform, isDragging } =
    useDraggable({
      id: member.name,
    });

  const style: CSSProperties = {
    transform: CSS.Translate.toString(transform),
    cursor: isDragging ? "grabbing" : "grab",
  };

  return (
    <div
      ref={setNodeRef}
      style={style}
      className={styles.member}
      {...attributes}
      {...listeners}
    >
      {member.name}
    </div>
  );
};
```

## ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä¸¦ã³æ›¿ãˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

æ¬¡ã¯ã‚°ãƒ«ãƒ¼ãƒ—ã‚’ D&D æ“ä½œã§ä¸¦ã³æ›¿ãˆã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/cda34286e53f-20231214.gif)

### ä¸¦ã³æ›¿ãˆã®ãŸã‚ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ä¸¦ã³æ›¿ãˆã‚’è¡Œã†ã«ã¯ `@dnd-kit/core` ã«åŠ ãˆã¦ `@dnd-kit/sortable` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚

```shell
yarn add @dnd-kit/sortable
```

### SortableContext

`DndContext` ã«åŠ ãˆã¦ã€`SortableContext` ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã€‚
`SortableContext` ã¯ä¸¦ã³æ›¿ãˆå¯èƒ½ãªã‚¢ã‚¤ãƒ†ãƒ ã®çŠ¶æ…‹ã‚’ç®¡ç†ã—ã€ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã«å¿œã˜ã¦ã‚¢ã‚¤ãƒ†ãƒ ã®é †åºã‚’æ›´æ–°ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã™ã‚‹ã€‚
`SortableContext` ã¯ `DndContext` å†…ã«è¨­ç½®ã™ã‚‹ã€‚

props ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

1. **`items`**
   - ä¸¦ã³æ›¿ãˆã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã® ID é…åˆ—ã‚’ä¸ãˆã‚‹
   - å‹ã¯ `string[] | { id: string }[]`
   - `string[]` ã®å ´åˆã¯å„è¦ç´ ãŒ è­˜åˆ¥å­ã¨ãªã‚Šã€`{ id: string }[]` ã®å ´åˆã¯å„è¦ç´ ã® `id` ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒè­˜åˆ¥å­ã¨ãªã‚‹
   - `items` ã«æŒ‡å®šã™ã‚‹è­˜åˆ¥å­ã¯å¾Œã«ä½¿ç”¨ã™ã‚‹ `useSortable` ã®å¼•æ•°ã«æŒ‡å®šã™ã‚‹ `id` ã¨ä¸€è‡´ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
2. **`strategy`**ï¼ˆOptionalï¼‰
   - ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä¸¦ã³æ›¿ãˆã‚‹æ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨å‹•ä½œã‚’å®šç¾©ã™ã‚‹
   - D&D æ“ä½œã«ãŠã‘ã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã®ç§»å‹•æ–¹æ³•ã‚’æ±ºå®šã™ã‚‹
   - `rectSortingStrategy`: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æˆ¦ç•¥ã€‚ä¸€èˆ¬çš„ãªãƒªã‚¹ãƒˆã‚„ã‚°ãƒªãƒƒãƒ‰ã«é©ã—ã¦ã„ã‚‹ã€‚ä»®æƒ³åŒ–ãƒªã‚¹ãƒˆã«ã¯éå¯¾å¿œã€‚
   - `verticalListSortingStrategy`: å‚ç›´ãƒªã‚¹ãƒˆã«æœ€é©åŒ–ã€‚ä»®æƒ³åŒ–ãƒªã‚¹ãƒˆã«å¯¾å¿œã€‚
   - `horizontalListSortingStrategy`: æ°´å¹³ãƒªã‚¹ãƒˆã«æœ€é©åŒ–ã€‚ä»®æƒ³åŒ–ãƒªã‚¹ãƒˆã«å¯¾å¿œã€‚
   - `rectSwappingStrategy`: ã‚¢ã‚¤ãƒ†ãƒ ã®ä½ç½®ã‚’ç›´æ¥äº¤æ›ï¼ˆã‚¹ãƒ¯ãƒƒãƒ—ï¼‰ã€‚ç‰¹å®šã®ã‚±ãƒ¼ã‚¹ã«é©ã—ã¦ã„ã‚‹ã€‚
3. **`id`**ï¼ˆOptionalï¼‰
   - `id` ã®æŒ‡å®šãŒãªã„å ´åˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹
   - ã“ã® prop ã¯é«˜åº¦ãªãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ãŸã‚ã®ã‚‚ã®

```tsx
+  import {
+    SortableContext,
+    horizontalListSortingStrategy,
+  } from "@dnd-kit/sortable";

   export const DndKit = () => {
     // çœç•¥

     return (
       <DndContext onDragEnd={handleDragEnd}>
+        <SortableContext items={groups} strategy={horizontalListSortingStrategy}>
           <div className={styles.groupContainer}>
             {groups.map((group) => (
               <GroupItem key={group.id} group={group} />
             ))}
           </div>
+        </SortableContext>
       </DndContext>
     );
   };
```

### `GroupItem` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä¸¦ã³æ›¿ãˆå¯èƒ½ãªè¦ç´ ã«è¨­å®šã™ã‚‹

`useSortable` ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ã™ã‚‹ã€‚
ã“ã®ãƒ•ãƒƒã‚¯ã®è¿”ã‚Šå€¤ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ä»»æ„ã®è¦ç´ ã‚’ä¸¦ã³æ›¿ãˆå¯èƒ½ã«ã™ã‚‹ã€‚

- `setActivatorNodeRef`: ãƒ‰ãƒ©ãƒƒã‚°ã™ã‚‹éš›ã®ã¤ã¾ã¿éƒ¨åˆ†ã® ref ã«æŒ‡å®šã™ã‚‹
- `attributes`, `listeners` ã‚‚ã¤ã¾ã¿éƒ¨åˆ†ã®è¦ç´ ã«æŒ‡å®šã™ã‚‹
- `setNodeRef` ã¯ç§»å‹•å¯¾è±¡ã¨ãªã‚‹ DOM ã«æŒ‡å®šã™ã‚‹

```diff tsx
  const GroupItem = ({ group }: GroupItemProps) => {
+   const {
+     attributes,
+     listeners,
+     setNodeRef: setSortableNodeRef,
+     setActivatorNodeRef,
+     transform,
+     transition,
+     isDragging,
+   } = useSortable({ id: group.id });

+   const style: CSSProperties = {
+     transform: CSS.Translate.toString(transform),
+     transition,
+   };

    // çœç•¥

    return (
+     <div ref={setSortableNodeRef} style={style} className={styles.groupItem}>
+       <div
+         ref={setActivatorNodeRef}
+         {...attributes}
+         {...listeners}
+         style={{ cursor: isDragging ? "grabbing" : "grab" }}
+         className={styles.groupHead}
+       >
          {group.id}
        </div>
+       <div ref={setDroppableNodeRef} className={styles.groupBody}>
          {group.members.map((member) => (
            <MemberItem key={member.name} member={member} />
          ))}
        </div>
      </div>
    );
  };
```

### ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‚’è¨­å®šã™ã‚‹

- `DndContext` ã® `onDragEnd` ã«ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¨˜è¿°ã™ã‚‹
- `handleDragEnd()` ã«è¿½è¨˜ã™ã‚‹
- é–¢æ•°å†…ã§ã€ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œãŒãƒ¡ãƒ³ãƒãƒ¼ã®ç§»å‹• or ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸¦ã³æ›¿ãˆã‹ã«ã‚ˆã£ã¦å‡¦ç†ã‚’åˆ†å²ã•ã›ã‚‹å¿…è¦ãŒã‚ã‚‹
- ãã®ãŸã‚ã€`active.id` ã¨ `over.id` ã§ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œãŒãƒ¡ãƒ³ãƒãƒ¼ã®ç§»å‹• or ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸¦ã³æ›¿ãˆã‹ã‚’åˆ¤æ–­ã§ãã‚‹ã‚ˆã†ã«å·¥å¤«ã™ã‚‹
- `active.id` ã¨ `over.id` ãŒ `member_` ã§å§‹ã¾ã‚Œã°ã€ãƒ¡ãƒ³ãƒãƒ¼ã®ç§»å‹•
- `group_` ã§å§‹ã¾ã‚Œã°ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸¦ã³æ›¿ãˆã¨ãªã‚‹ã‚ˆã†ã«ã™ã‚‹

ä¸‹è¨˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® `useDropppable` ã¯ãƒ¡ãƒ³ãƒãƒ¼ã®ç§»å‹•ã«ä½¿ç”¨ã™ã‚‹ã‚‚ã®ãªã®ã§ã€`id` ã‚’ `member_${group.id}` ã«å¤‰æ›´ã™ã‚‹ã€‚

```diff tsx
  const GroupItem = ({ group, isGroupDragging }: GroupItemProps) => {
    // çœç•¥

    const { setNodeRef: setDroppableNodeRef } = useDroppable({
+     id: `member_${group.id}`,
      disabled: isGroupDragging,
    });

    return (
      // çœç•¥
    );
  };
```

`handleDragEnd` ã¯ä»¥ä¸‹ã®é€šã‚Šã€‚

```diff tsx
 const handleDragEnd = (e: DragEndEvent) => {
   const { active, over } = e;

   if (!over) return;

   const draggedId = active.id as string;
   const droppedId = over.id as string;

+  if (draggedId.startsWith("member_") && droppedId.startsWith("member_")) {
     setGroups((prev) => {
       return prev.map((group) => {
         const isDroppedSameGroup =
           group.members.some((member) => member.name === draggedId) &&
           droppedId === group.id;
         if (isDroppedSameGroup) return group;

         const newMembers = group.members.filter(
           (member) => member.name !== draggedId
         );

         if (droppedId === group.id) newMembers.push({ name: draggedId });

         return { ...group, members: newMembers };
       });
     });
+  } else if (draggedId.startsWith("group_") && droppedId.startsWith("group_")) {
+    setGroups((prev) => {
+      const prevIndex = prev.findIndex((group) => group.id === draggedId);
+      const newIndex = prev.findIndex((group) => group.id === droppedId);
+
+      return arrayMove(prev, prevIndex, newIndex);
+    });
+  }
 };
```

:::details arrayMove

- é…åˆ—å†…ã®è¦ç´ ã‚’æ–°ã—ã„ä½ç½®ã«ç§»å‹•ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚Œã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

```ts
arrayMove(array: T[], from: number, to: number): T[]
```

- `array` : ä¸¦ã³æ›¿ãˆå¯¾è±¡ã®é…åˆ—
- `from` : å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹æ™‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
- `to` : å¯¾è±¡ã‚¢ã‚¤ãƒ†ãƒ ã‚¢ã‚¤ãƒ†ãƒ ã®ãƒ‰ãƒ©ãƒƒã‚°çµ‚äº†æ™‚ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹

:::

ã“ã‚Œã§ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸¦ã³æ›¿ãˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚
ã¨æ€ã„ãã‚„ä¸¦ã³æ›¿ãˆä¸­ã«ãƒã‚°ãŒ...

## `useSortable` ã¨ `useDroppable` ã®ç«¶åˆ

ç¾çŠ¶ã ã¨ã€ã‚°ãƒ«ãƒ¼ãƒ—ã®ãƒ‰ãƒ©ãƒƒã‚°ä¸­ã«ãƒã‚°ãŒå‡ºã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/33f8622e510e-20231214.gif)

`useSortable` ãŒç®¡ç†ã™ã‚‹è¦ç´ ã®ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œä¸­ã«ã€`useDroppable` ã§å®šç¾©ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å…¥ã‚‹ã¨ã€ãƒã‚°ãŒç”Ÿã˜ã‚‹ã€‚

### `useSortable` ã®ä»•çµ„ã¿

`useSortable` ã¯ã€`useDraggable` ã¨ `useDroppable` ã‚’æŠ½è±¡åŒ–ã—ãŸãƒ•ãƒƒã‚¯ã§ã€ã“ã‚Œã‚‰ã‚’çµ„ã¿åˆã‚ã›ã¦è¦ç´ ã‚’ä¸¦ã³æ›¿ãˆå¯èƒ½ã«ã—ã¦ã„ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/a8255e54bfcc-20231214.webp)
_å¼•ç”¨ï¼šhttps://docs.dndkit.com/presets/sortable_

### åŸå› 

åŸå› ã¯ã€`GroupItem` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãŠã„ã¦ã€ `useSortable` ã¨ `useDroppable` ã®ãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸãŒç«¶åˆã—ã¦ã„ã‚‹ã“ã¨ã«ã‚ã‚‹ã€‚

```tsx
const GroupItem = ({ group }: GroupItemProps) => {
  const {
    attributes,
    listeners,
    setNodeRef: setSortableNodeRef,
    setActivatorNodeRef,
    transform,
    transition,
    isDragging,
  } = useSortable({ id: group.id });

  const { setNodeRef: setDroppableNodeRef } = useDroppable({
    id: `member_${group.id}`,
  });

  const style: CSSProperties = {
    transform: CSS.Translate.toString(transform),
    transition,
  };

  return (
    <div ref={setSortableNodeRef} style={style} className={styles.groupItem}>
      <div
        ref={setActivatorNodeRef}
        {...attributes}
        {...listeners}
        style={{ cursor: isDragging ? "grabbing" : "grab" }}
        className={styles.groupHead}
      >
        {group.id}
      </div>
      <div ref={setDroppableNodeRef} className={styles.groupBody}>
        {group.members.map((member) => (
          <MemberItem key={member.name} member={member} />
        ))}
      </div>
    </div>
  );
};
```

ä¸Šè¨˜ã‚³ãƒ¼ãƒ‰ã®å ´åˆã€`GroupItem` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/894fac85a585-20231214.png)

- `useSortable` ãŒç®¡ç†ã™ã‚‹ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œä¸­ã«ã€`useDroppable({id: 'member_xxxx'})` ã§å®šç¾©ã•ã‚ŒãŸãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã«å…¥ã‚‹ã¨ã€è¡çªæ¤œå‡ºã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ãŒ `useDroppable` ã® `{id: 'member_xxxx'}` ã‚’æ¤œå‡ºã™ã‚‹
- `useDroppable({id: 'group_xxxx'})` ã¨ `useDroppable({id: 'member_xxxx'})` ã¯é ˜åŸŸãŒè¢«ã‚‹éƒ¨åˆ†ãŒã‚ã‚‹ãŒã€å­è¦ç´ ã§ã‚ã‚‹ `id: 'member_xxxx'` ãŒå„ªå…ˆã•ã‚Œã‚‹
- ã“ã‚ŒãŒã€`useSortable` ã®ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹
- `{id: 'member_xxxx'}` ã¯ `useSortable` ã§å®šç¾©ã—ãŸ `id` ã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ãŒå­˜åœ¨ã—ãªã„ãŸã‚ã€ã‚½ãƒ¼ãƒˆå‡¦ç†ã‚’è¡Œãˆãªã„

### è§£æ±ºç­–

**ã‚°ãƒ«ãƒ¼ãƒ—ã®ä¸¦ã³æ›¿ãˆä¸­ã¯ `useDroppable` ã‚’ç„¡åŠ¹ã«ã™ã‚‹**

- `useDroppable` ã®å¼•æ•°ã«ã¯ `disabled` ãŒå­˜åœ¨ã™ã‚‹
- `disabled` ã« `true` ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€ç«¶åˆã—ã¦ã„ãŸãƒ‰ãƒ­ãƒƒãƒ—é ˜åŸŸã‚’ç„¡åŠ¹ã«ã™ã‚‹

è¤‡æ•°ã‚ã‚‹ `useSortable` ã®ã©ã‚Œã‹ãŒãƒ‰ãƒ©ãƒƒã‚°çŠ¶æ…‹ã«ãªã£ãŸã¨ãã€å…¨ã¦ã® `useDroppable` ã‚’ç„¡åŠ¹ã«ã—ãŸã„ã®ã§ã€ã‚¹ãƒ†ãƒ¼ãƒˆã«ã‚ˆã‚‹ç®¡ç†ã‚’è¡Œã†ã€‚

```diff tsx
  export const DndKit = () => {
    // çœç•¥

+   const [isGroupDragging, setIsGroupDragging] = useState(false);

+   const handleDragStart = (e: DragStartEvent) => {
+     const { active } = e;
+     const draggedId = active.id as string;

+     if (draggedId.startsWith("group_")) setIsGroupDragging(true);
+   };

    const handleDragEnd = (e: DragEndEvent) => {
+     setIsGroupDragging(false);

      // çœç•¥
    };

    return (
+     <DndContext onDragStart={handleDragStart} onDragEnd={handleDragEnd}>
        <SortableContext items={groups} strategy={horizontalListSortingStrategy}>
          <div className={styles.groupContainer}>
            {groups.map((group) => (
              <GroupItem
                key={group.id}
                group={group}
+               isGroupDragging={isGroupDragging}
              />
            ))}
          </div>
        </SortableContext>
      </DndContext>
    );
  };

ã€€type GroupItemProps = {
ã€€  group: Group;
+  isGroupDragging: boolean;
ã€€};

+ const GroupItem = ({ group, isGroupDragging }: GroupItemProps) => {
ã€€  // çœç•¥

ã€€  const { setNodeRef: setDroppableNodeRef } = useDroppable({
ã€€    id: `member_${group.id}`,
+    disabled: isGroupDragging,
ã€€  });

ã€€  // çœç•¥
ã€€};
```

ã“ã‚Œã§ãƒã‚°ãŒæ¶ˆãˆã‚‹ã€‚

![](https://storage.googleapis.com/zenn-user-upload/4669a01a7bab-20231214.gif)

## å‚è€ƒãƒªãƒ³ã‚¯

https://docs.dndkit.com/

https://zenn.dev/castingone_dev/articles/dndkit20231031

https://zenn.dev/kodaishoituki/articles/0e1c6109ae838e#sortablecontext

https://zenn.dev/wintyo/articles/d39841c63cc9c9
