---
title: "【アンチパターン】非スカラ値（第 1 正規形未満）"
---

## 第 1 正規形についておさらい

第 1 正規形の定義は
**一つのセルの中には一つの値しか含まない**

**社員テーブル**
| 会社コード | 会社名 | 社員 ID | 社員名　 | 年齢 | 部署コード | 部署名 |
| ---------- | ------ | ------- | -------- | ---- | ---------- | ------ |
| C0001 | A 商事 | 000A | 中島 | 40 | D01 | 開発 |
| C0001 | A 商事 | 000B | 藤本 | 32 | D02 | 人事 |
| C0001 | A 商事 | 001F | 三島 | 50 | D03 | 営業 |
| C0002 | B 科学 | 000A | 斉藤 | 47 | D03 | 営業 |
| C0002 | B 科学 | 009F | 田島 | 25 | D01 | 開発 |
| C0002 | B 科学 | 010A | 渋谷 | 33 | D04 | 総務 |

上記のように、一つのセルに一つだけの値が含まれているとき、その値を「**スカラ値（scalar value）**」と呼ぶ。
scalar は「単一の」という意味の英単語。

## 配列型による非スカラ値

**`扶養者`テーブル**
| 社員 ID | 社員名 | 子 |
| ------- | ------ | -------------- |
| 000A | 加藤 | 達夫, 信二 |
| 000B | 藤本 | |
| 001F | 三島 | 敦, 陽子, 清美 |

- この表は、`子` 列が非スカラ値
- そのため、これは RDB における「テーブル」ではない
- しかし、SQL には「**配列型**」が存在する
- そのため、テーブルの一つの列を配列として扱うことができる
- つまり、**非スカラ値を含むテーブルを作ることができる**

テーブル作成の DDL（テーブルの物理定義 SQL）は以下の通り。

```sql
CREATE TABLE huyosha (
  shain_id varchar(4),
  shain_mei varchar(20),

  kodomo varchar(20)[], ← 配列型の宣言
  PRIMARY KEY(shain_id)
);
```

レコードの INSERT 文は以下の通り。

```sql
INSERT INTO huyosha VALUES ("000A", "加藤", "{達夫, 信二}");
INSERT INTO huyosha VALUES ("000B", "藤本", NULL);
INSERT INTO huyosha VALUES ("001F", "三島", "{敦, 陽子, 清美}");
```

- プログラミング言語は配列を扱うことができる
- それに合わせる形で RDB も配列を扱えるようになった
  - DB とアプリケーションとの間でデータ受け渡しに齟齬ができてしまうのを防ぐため

![](https://storage.googleapis.com/zenn-user-upload/e1b204c8b650-20231026.png)

- しかし、RDB で配列を扱うのはバッドノウハウ
- 配列を扱う機能は存在するが、一般的には普及してない
- DB 側だけが配列型に対応しても、アプリケーションやミドルウェアも対応しなければ意味がない
- よって、現状は安易に配列型を使用せず、第 1 正規形の確保を優先する
- 配列型を採用する場合は、DB 内部に閉じた設計だけでなく、アプリケーションやミドルウェアとの整合性を考慮しなければならない

:::message
**配列型は利用しない。**
**第 1 正規形を守る。**
:::

## スカラ値の基準は何か？

- スカラ値の基準は、第一正規形に関連して、テーブル内の値が**原子的**であることを指す
- 「原子的な値」は、分解できない単一の値で構成されている
- 例えば、会社名や年齢など、分解すると意味が失われるような値はスカラ値と見なされる
- ただし、一部の値は論理的に分解可能で、データベース設計は要件に依存する
- 例えば、人名やメールアドレスは、分解して保存することができる
- 著者の見解では、情報は可能な限り分解し、原子的な形でデータを保持すべきであり、後で必要に応じて結合することが容易
- 結合された情報を後から分解することは難しい場合があるため、分解を推奨する

:::message
**スカラ値の基準は、データを原子的な単一の値として保持し、必要に応じて分解や結合することができるようにする。**
:::
