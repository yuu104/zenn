---
title: "【Playwright】ナビゲーション"
---

ナビゲーションは URL に関連する「アクション」をまとめた機能群です。

## goto()

`goto()` メソッドは、Playwright で最も頻繁に使用されるナビゲーション機能の一つです。このメソッドは、ユーザーがブラウザで特定のページを開く動作をシミュレートします。

1. **基本的な使い方**

   ```javascript
   await page.goto("http://example.com");
   ```

   この操作は、指定された URL のページを開きます。
   `await` キーワードを使用することで、ページの遷移が完了し、CSS や JavaScript、画像などのリソースが読み込まれるまで待機します。
   これにより、ページが完全に読み込まれた後でテストや操作を開始できます。

2. **相対パスの使用**

   Playwright の設定ファイル（`playwright.config.ts`）で `baseURL` を設定している場合、`goto()` メソッドで相対パスを使用できます。これは、テストコードをより簡潔に保ち、柔軟性を高めるのに役立ちます。

   例えば、以下のように設定ファイルで `baseURL` を指定した場合：

   ```typescript
   // playwright.config.ts
   import { defineConfig, devices } from "@playwright/test";

   export default defineConfig({
     use: {
       baseURL: "http://localhost:3000",
     },
   });
   ```

   テストコード内では、次のように相対パスを使用できます。

   ```javascript
   await page.goto("/login"); // http://localhost:3000/login にアクセスします
   ```

   この方法を使用すると、テスト環境や本番環境など、異なる環境間での URL の切り替えが容易になります。
   また、テストコードがより読みやすく、メンテナンスしやすくなります。

## waitForURL()

`waitForURL()` は、ページ遷移が完了するまで待機する機能を提供します。

1. **使用場面**

   このメソッドは以下のような状況で特に有用です。

   1. リンクのクリック後の遷移
   2. ページ遷移を伴うボタンのクリック
   3. フォーム送信後のリダイレクト

   これらのアクションを実行した後、新しいページへの遷移が完了するまで待機します。

2. **ページ遷移の裏で起こっている処理**

   1. サーバーへのリクエスト送信
   2. 新しいコンテンツのロード
   3. 必要に応じてリダイレクトの処理

   この過程は人間の目には瞬時に見えますが、テストコードではサーバーアクセスを待つ必要があるため、待機時間が発生します。

3. **使用例**

   ```javascript
   await page.waitForURL("*/login");
   ```

   この例では、URL が `/login` で終わるページへの遷移が完了するまで待機します。

:::message

結果確認のロケーターが遷移前のページにアクセスして間違った検証を行ってしまう可能性があります。`waitForURL()` を使用することで、この問題を回避できます。

しかし、通常のウェブサイト操作では、「URL が変わった」ことを毎回目視で確認してからページ操作をすることはありません。ブラウザに表示されているコンテンツの変化を確認してページが変わったことを知るはずです。

そのため、`waitForURL()` の使用は必須ではありません。テストの後続の操作に支障がなければ、このナビゲーション待機を使用する必要はない場合もあります。

:::

`waitForURL()` は、特定の URL への遷移を確実に待つ必要がある場合に有用なメソッドです。
しかし、多くの場合、ページ上の要素の変化を待つ他のメソッド（例：`waitForSelector()`）で代用可能です。
テストのシナリオや対象のウェブアプリケーションの挙動に応じて、適切な待機方法を選択することが重要です。

## toHaveTitle() と toHaveURL() - ナビゲーションに特化したマッチャー

画面の中のコンテンツに対するマッチャーについては後ほど詳しく紹介しますが、本節ではナビゲーションに特化したマッチャーを 2 つ紹介します。

1. `toHaveTitle()`: ページのタイトルを確認します。
2. `toHaveURL()`: URL を確認します。

両方のマッチャーは文字列と正規表現を使用できます。以下のサンプルコードでは正規表現を使用しています。

```javascript
// タイトルを確認
await expect(page).toHaveTitle(/商品詳細/);

// URLを確認
await expect(page).toHaveURL(/.*checkout/);
```

これらのマッチャーには重要な特徴があります。

1. **デフォルトで 5 秒間リトライを続ける**
   ナビゲーションはテストコードから見ると無視できない待ちが発生すると前述しましたが、これらのマッチャーは期待した状態になるまでデフォルトで 5 秒間リトライし続けます。

2. **明示的な待機が不要**
   このリトライ機能により、`waitForURL()` のような明示的な待ちの指示は必要ありません。

3. **テスト固有の確認**：
   これらのマッチャーは、人間がブラウザを操作する場合にほとんど意識することのない項目をチェックします。
   そのため、他の項目で代用できる場合は、これらを利用するほうが自然なテストになるでしょう。
