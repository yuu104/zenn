---
title: "測定と振り返り"
---

## 何故「測定」と「振り返り」をするのか？

- 導入コストに見合った成果を得られるかを知るため
- 施策の方向性が妥当だったのかを知るため
- 「何となく導入したまま、やがてメンテナンスされなくなる...」という状態をなくすため

## 「測定」と「振り返り」のポイント

1. **継続的に測定し続ける**
   低頻度な計測はアンチパターンです。

   - 一度きりだけ測定する
   - 毎月末に行われる全大会で発表するために、月に 1 回測定する

   \
    「計測頻度が低い」→ 「振り返りの頻度が低い」→ 「軌道修正のタイミングが少ない」
   ということです。
   そうなると、一度に行う意思決定の影響範囲が大きくなります。それ故に、意思決定までの時間が長くなります。
   \
   頻度高く継続的に測定し続けることにより、起動修正を重ねながら常に良い方向に向かうようにチームを調整し続けることができます。
   ![](https://storage.googleapis.com/zenn-user-upload/917140e783e5-20241020.png)

2. **自動化する**
   頻度高く継続的に測定するために重要なことは何でしょうか？
   そう、**自動化**です。
   テスト実行の度に集計されるような仕組みがあれば、継続的な測定は簡単になります。
   \
   自動化する際は、まず次のような取り組みから始めると良いでしょう。
   - 自動測定しやすいメトリクス（測定項目）から始め、トレンドを把握する
   - とにかくデータを収集する
3. **振り返る**
   測定する「だけ」で終わってはいけません。
   必ず定期的に振り返り、施策が正しい方向に向かっているかを確認しましょう。
4. **一度にすべてをやる必要はない**
   最初からすべてのメトリクスを揃える必要はありません。
   重要なのは、**メトリクスを 1 つでもいいから自動測定し、定期的に振り返る**ことです。
   振り返りを通じて、追加で必要なメトリクスを検討する形で進めましょう。

## 主要メトリクス

自動テストの目的として、「**安全にリリースできる状態を、持続可能なコストにキープし続ける**」がありました。
メトリクスの設定にあたり、この目的を意識すると良いでしょう。

### カバレッジ

テストがある項目をどれだけカバーしているかを表します。
分母となる「**カバレッジアイテム**」の総数に対して、カバーされているアイテムがどれだけあるのかを測定します。

分母となるカバレッジアイテムには様々なものが用いられ、それぞれに向き不向きがあります。
今回は、以下二つのカバレッジアイテムを紹介します。

1. **コードカバレッジ**

   - ソースコードに対するカバレッジ
   - テスト実行によって**コードの行や分岐が十分に実行されたかどうか**を測る
   - **ソフトウェアが正しく動作しているかについては評価しない**

   \
    つまり、コードカバレッジはあくまでテストがコードの中のどれだけの部分をカバーできたかを表す指標にすぎません。
   よって

   - 「カバレッジが高い」ことは仕様を十分にカバーしていることを意味しません
     :::details 具体例
     電話番号を入力するフォームを対象に考える。
     バリデーションは HTML の正規表現を利用する。
     つまり、ブラウザ側が勝手にバリデーションしてくれるので、アプリケーションコードにバリデーションロジックの記述は存在しない。
     \
     この場合、1 つのテストケースだけでコードカバレッジが 100%になる。
     しかし、ブラウザ機能に任せているバリデーションチェックが正しく動作しているかの検証はしていない。
     よって、この状態はアプリケーションの仕様を十分にカバーしたテストができているとは限らない。
     :::
   - 「カバレッジが低い」ことはテストが不十分であるとは言い切れません
     :::details 具体例
     デッドコード（どのような手順を取っても到達しないコード）が多い場合、カバレッジは低くなる。
     しかし、このような場合はテストが不十分であるわけではない。
     :::

   :::message
   **コードカバレッジの種類**

   1. **C0 カバレッジ（ステートメントカバレッジ）**

      - コードの各行がテストで実行されたかどうかを測定する
      - 全ての行が一度でも実行されれば、カバレッジは 100%となる

   2. **C1 カバレッジ（ブランチカバレッジ）**
      - コードの各分岐（if 文や switch 文など）がテストで実行されたかどうかを測定する
      - すべての分岐が一度でも実行されれば、カバレッジは 100%となる
   3. **パスカバレッジ**
      - すべての可能なパス（特定の関数やメソッド、ブロック）がテストで実行されたかどうかを測定する
      - すべてのパスが少なくとも一度は実行されれば、パスカバレッジは 100%となる

   :::
