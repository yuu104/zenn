---
title: "単体テストの定義"
---

## 単体テストとは？

「単体テスト」とは以下の 4 つを備えたテストのことです。

- 「単体（unit）」と呼ばれる少量のコードを検証する
- 自動化されている
- 実行時間が短い
- 隔離された状態で実行される

「隔離された状態で実行される」とはどういうことでしょうか？
これは、少量のコード（クラスや関数といった「単体」）が**依存関係の影響を受けずに独立してテストされる**ことを意味しています。

これにより、「テスト結果が純粋にテスト対象のコードそのものに基づいている」ことが保証され、バグの原因を特定しやすくなります。

ただ、「隔離」の考え方について、実は 2 つの代表的なアプローチがあります。
それが「**ロンドン学派**」と「**古典学派**」です。
この 2 つはコードの依存関係の扱い方に関する考え方が異なるため、「隔離」の意味も変わってきます。

## ロンドン学派

ロンドン学派の考える「隔離」とは、**テスト対象のコードが他の依存関係から完全に切り離されてテストされること**を意味します。
このため、テスト対象のコンポーネント（クラスや関数）は、他のコンポーネントの影響を全く受けず、独立して動作することを確認することができます。

この「隔離」を実現するために、ロンドン学派ではテストダブルを積極的に使用します。

:::details テストダブルとは？
テスト対象が依存している他のクラスやオブジェクトの代わりに用いられる擬似オブジェクトの総称です。

テストダブルには様々なタイプがありますが、その中には以下が含まれます。

- **モック（Mock）**：
  特定のインタラクションが正しく行われることを確認するために使用されるダミーオブジェクト。
- **スタブ（Stub）**：
  固定の応答を返すことで依存部分を代替する簡単なオブジェクト。
- **フェイク（Fake）**：
  簡易的な実装を行うことで依存部分を模擬するオブジェクト。
- **スパイ（Spy）**：
  インタラクションの記録と検証を行うためのオブジェクト。

:::

![](https://storage.googleapis.com/zenn-user-upload/12df69268eb1-20241204.png)

### テストダブルの利点

1. **テストが失敗したときに、どのコードが原因なのかを明確にできる**
   テスト対象のコンポーネントへの依存をすべてテストダブルに置き換えます。
   そのため、依存コンポーネントはテスト失敗の原因対象から外れ、テスト対象のコンポーネントに限定して問題箇所を特定できるようになります。
2. **複雑に絡み合った依存関係を分離できる**
   テスト対象のコンポーネントには大抵、複数の他のコンポーネントへの依存があります。
   その依存先コンポーネントもまた、依存しているコンポーネントが存在し...と、複雑になっています。
   \
   このような複雑に絡み合ったコードをそのままテストに使用すると、以下の点でデメリットが生じます。

   - テストの実行に時間がかかる
   - テスト結果が不安定になる
   - テストが失敗した際の原因特定が困難になる

   \
   テストダブルを用いれば、複雑な依存関係を打ち切ることができます。
   また、「1 つのテストケースは 1 つのコンポーネントしか検証しない」と決めれば、テスト全体がシンプルな構造となります。
   そして、責務分離によりテストケースの作成がしやすくなります。
   ![](https://storage.googleapis.com/zenn-user-upload/a49a2b10181c-20241204.png)
   _テストクラスとプロダクションコードのクラスを 1:1 にする_
